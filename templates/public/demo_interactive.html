{% extends 'public/base.html' %}
{% load static %}

{% block title %}Démonstration Interactive - Edtia{% endblock %}

{% block meta_description %}Testez Edtia avec vos données réelles. Créez des emplois du temps optimisés pour votre établissement avec notre démonstration interactive.{% endblock %}

{% block extra_css %}
<style>
    /* Animations personnalisées */
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }
    
    @keyframes glow {
        0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
        50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6); }
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fadeInScale {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    
    .animate-float {
        animation: float 3s ease-in-out infinite;
    }
    
    .animate-glow {
        animation: glow 2s ease-in-out infinite;
    }
    
    .animate-slide-in-up {
        animation: slideInUp 0.6s ease-out;
    }
    
    .animate-fade-in-scale {
        animation: fadeInScale 0.5s ease-out;
    }
    
    /* Effet de particules pour le loading */
    .particles {
        position: relative;
        overflow: hidden;
    }
    
    .particles::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    
    /* Effet de pulsation pour les barres de progression */
    .progress-bar {
        position: relative;
        overflow: hidden;
    }
    
    .progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
        animation: progress-shimmer 1.5s infinite;
    }
    
    @keyframes progress-shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    
    /* Styles personnalisés pour la démonstration interactive */
    .demo-container {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .config-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
    }
    
    .result-card {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(15px);
    }
    
    .floating-button {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
    }
    
    .floating-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
    }
    
    .emploi-temps-table {
        font-size: 0.75rem;
    }
    
    .emploi-temps-table th,
    .emploi-temps-table td {
        padding: 0.25rem 0.125rem;
        border: 1px solid #e5e7eb;
    }
    
    .emploi-temps-table th {
        background-color: #f9fafb;
        font-weight: 600;
        color: #374151;
    }
    
    .cours-cell {
        background-color: #dbeafe;
        color: #1e40af;
        border-radius: 0.25rem;
        margin: 0.125rem;
        padding: 0.125rem 0.25rem;
        font-size: 0.625rem;
        line-height: 1;
        text-align: center;
        min-height: 1.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .prof-cell {
        background-color: #dcfce7;
        color: #166534;
        border-radius: 0.25rem;
        margin: 0.125rem;
        padding: 0.125rem 0.25rem;
        font-size: 0.625rem;
        line-height: 1;
        text-align: center;
        min-height: 1.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .salle-cell {
        background-color: #fef3c7;
        color: #92400e;
        border-radius: 0.25rem;
        margin: 0.125rem;
        padding: 0.125rem 0.25rem;
        font-size: 0.625rem;
        line-height: 1;
        text-align: center;
        min-height: 1.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .classe-cell {
        background-color: #e0e7ff;
        color: #3730a3;
        border-radius: 0.25rem;
        margin: 0.125rem;
        padding: 0.125rem 0.25rem;
        font-size: 0.625rem;
        line-height: 1;
        text-align: center;
        min-height: 1.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .emploi-temps-table {
            font-size: 0.625rem;
        }
        
        .cours-cell,
        .prof-cell,
        .salle-cell,
        .classe-cell {
            font-size: 0.5rem;
            padding: 0.125rem;
            margin: 0.0625rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-gradient text-white py-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">
            Démonstration Interactive
        </h1>
        <p class="text-xl text-blue-100 mb-8">
            Créez des emplois du temps optimisés avec vos données réelles
        </p>
        
        <!-- Bouton générer rapide -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
            <button onclick="genererEmploiTemps()" 
                    class="bg-white text-blue-600 px-8 py-4 rounded-lg font-semibold text-lg hover:bg-gray-100 transition-colors shadow-lg flex items-center">
                <i data-lucide="play" class="mr-2"></i>
                Générer l'emploi du temps
            </button>
            <div class="text-blue-100 text-sm">
                <i data-lucide="info" class="inline-block mr-1"></i>
                Configurez d'abord votre établissement ci-dessous
            </div>
        </div>
    </div>
</section>

<!-- Interface de démonstration -->
<section class="py-20 bg-gray-50">
    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
            <!-- Configuration -->
            <div class="xl:col-span-1">
                <div class="bg-white p-6 rounded-xl shadow-lg sticky top-8">
                    <!-- Bouton générer en haut -->
                    <div class="mb-6">
                        <button onclick="genererEmploiTemps()" 
                                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors shadow-lg flex items-center justify-center">
                            <i data-lucide="play" class="mr-2"></i>
                            Générer l'emploi du temps
                        </button>
                        <p class="text-xs text-gray-500 text-center mt-2">
                            <i data-lucide="info" class="inline-block mr-1"></i>
                            Configurez d'abord les paramètres ci-dessous
                        </p>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">
                        Configuration de votre établissement
                    </h2>
                    
                    <form id="demo-config" class="space-y-6">
                        <!-- Informations générales -->
                        <div class="border-b border-gray-200 pb-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Informations générales</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nom de l'établissement</label>
                                    <input type="text" id="nom_etablissement" value="Collège Victor Hugo" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Type d'établissement</label>
                                    <select id="type_etablissement" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="college">Collège</option>
                                        <option value="lycee">Lycée</option>
                                        <option value="ecole_primaire">École primaire</option>
                                        <option value="universite">Université</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ressources humaines -->
                        <div class="border-b border-gray-200 pb-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Ressources humaines</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre d'enseignants</label>
                                    <input type="number" id="nb_enseignants" min="5" max="100" value="25" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de classes</label>
                                    <input type="number" id="nb_classes" min="3" max="30" value="12" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre d'élèves</label>
                                    <input type="number" id="nb_eleves" min="50" max="2000" value="300" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ressources matérielles -->
                        <div class="border-b border-gray-200 pb-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Ressources matérielles</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de salles</label>
                                    <input type="number" id="nb_salles" min="5" max="50" value="18" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Salles spécialisées</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="salle_sport" class="mr-3" checked>
                                            <span class="text-gray-700">Salle de sport</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="salle_info" class="mr-3" checked>
                                            <span class="text-gray-700">Salle informatique</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="labo_sciences" class="mr-3">
                                            <span class="text-gray-700">Laboratoire de sciences</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="salle_arts" class="mr-3">
                                            <span class="text-gray-700">Salle d'arts plastiques</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contraintes particulières -->
                        <div class="border-b border-gray-200 pb-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Contraintes particulières</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Enseignants à temps partiel</label>
                                    <input type="number" id="temps_partiel" min="0" max="20" value="3" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Contraintes de transport</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="transport_matin" class="mr-3">
                                            <span class="text-gray-700">Arrivée matinale limitée (8h30)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="transport_soir" class="mr-3">
                                            <span class="text-gray-700">Départ soirée limité (17h00)</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Préférences enseignants</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="pref_matin" class="mr-3" checked>
                                            <span class="text-gray-700">Préférence cours du matin</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="pref_journee" class="mr-3" checked>
                                            <span class="text-gray-700">Éviter les journées trop longues</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Matières -->
                        <div class="pb-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Répartition des matières</h3>
                            
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700">Mathématiques</span>
                                    <input type="number" id="maths" min="0" max="20" value="5" 
                                           class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700">Français</span>
                                    <input type="number" id="francais" min="0" max="20" value="5" 
                                           class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700">Histoire-Géographie</span>
                                    <input type="number" id="histoire" min="0" max="20" value="3" 
                                           class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700">Sciences</span>
                                    <input type="number" id="sciences" min="0" max="20" value="4" 
                                           class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700">Langues</span>
                                    <input type="number" id="langues" min="0" max="20" value="3" 
                                           class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700">EPS</span>
                                    <input type="number" id="eps" min="0" max="20" value="2" 
                                           class="w-16 px-2 py-1 border border-gray-300 rounded text-center">
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" onclick="genererEmploiTemps()" 
                                class="w-full bg-blue-600 text-white py-4 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors">
                            <i data-lucide="play" class="inline-block mr-2"></i>
                            Générer l'emploi du temps
                        </button>
                        
                        <!-- Bouton génération rapide -->
                        <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-600 text-center mb-2">Génération rapide</p>
                            <button type="button" onclick="genererEmploiTemps()" 
                                    class="w-full bg-gray-600 text-white py-2 rounded-lg font-semibold text-sm hover:bg-gray-700 transition-colors">
                                <i data-lucide="zap" class="inline-block mr-1"></i>
                                Générer rapidement
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Résultats -->
            <div class="xl:col-span-3">
                <div id="demo-results" class="space-y-8">
                    <!-- Message d'accueil -->
                    <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                        <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-6">
                            <i data-lucide="calendar" class="text-blue-600 w-8 h-8"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">
                            Prêt à créer votre emploi du temps ?
                        </h3>
                        <p class="text-gray-600 mb-6">
                            Configurez votre établissement dans le panneau de gauche, puis cliquez sur "Générer l'emploi du temps" pour voir la magie opérer !
                        </p>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-blue-800 text-sm">
                                <i data-lucide="info" class="inline-block mr-2"></i>
                                Notre IA analysera toutes vos contraintes et générera un emploi du temps optimisé en quelques secondes.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Fonctionnalités avancées -->
<section class="py-20 bg-white">
    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-gray-900 mb-6">
                Fonctionnalités de la démonstration
            </h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                Découvrez toutes les capacités d'Edtia avec cette démonstration interactive
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-100">
                <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="settings" class="text-white"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-3">Configuration flexible</h3>
                <p class="text-gray-600">Adaptez tous les paramètres à votre établissement : nombre d'enseignants, classes, salles, contraintes spéciales.</p>
            </div>
            
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-100">
                <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="brain" class="text-white"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-3">IA avancée</h3>
                <p class="text-gray-600">Notre intelligence artificielle analyse toutes les contraintes et génère des emplois du temps optimaux.</p>
            </div>
            
            <div class="bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-100">
                <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="bar-chart" class="text-white"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-3">Analytics en temps réel</h3>
                <p class="text-gray-600">Visualisez les métriques d'optimisation, la satisfaction des enseignants et l'utilisation des ressources.</p>
            </div>
            
            <div class="bg-gradient-to-br from-orange-50 to-red-50 p-6 rounded-xl border border-orange-100">
                <div class="w-12 h-12 bg-orange-600 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="users" class="text-white"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-3">Gestion des remplaçants</h3>
                <p class="text-gray-600">Simulez des absences et voyez comment l'IA propose automatiquement des remplaçants qualifiés.</p>
            </div>
            
            <div class="bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-xl border border-teal-100">
                <div class="w-12 h-12 bg-teal-600 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="trending-up" class="text-white"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-3">Prédiction d'absences</h3>
                <p class="text-gray-600">L'IA prédit les absences probables et ajuste automatiquement l'emploi du temps.</p>
            </div>
            
            <div class="bg-gradient-to-br from-pink-50 to-rose-50 p-6 rounded-xl border border-pink-100">
                <div class="w-12 h-12 bg-pink-600 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="download" class="text-white"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-3">Export des résultats</h3>
                <p class="text-gray-600">Téléchargez vos emplois du temps générés au format PDF, Excel ou intégrez-les dans votre système.</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-20 hero-gradient text-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-4xl font-bold mb-6">
            Prêt à transformer votre établissement ?
        </h2>
        <p class="text-xl mb-8 text-blue-100">
            Commencez votre essai gratuit de 30 jours dès aujourd'hui
        </p>
        <div class="flex flex-col sm:flex-row gap-6 justify-center">
            <a href="{% url 'public:demo' %}" class="bg-white text-blue-600 px-8 py-4 rounded-lg font-semibold text-lg hover:bg-gray-100 transition-colors shadow-lg">
                <i data-lucide="rocket" class="inline-block mr-2"></i>
                Commencer l'essai gratuit
            </a>
            <a href="{% url 'public:contact' %}" class="border-2 border-white text-white px-8 py-4 rounded-lg font-semibold text-lg hover:bg-white hover:text-blue-600 transition-colors">
                <i data-lucide="phone" class="inline-block mr-2"></i>
                Parler à un expert
            </a>
        </div>
    </div>
</section>

<!-- Listes prédéfinies -->
<div id="listes-predefinies" class="mt-8">
    <!-- Les listes seront générées ici par JavaScript -->
</div>

<!-- Bouton flottant pour générer -->
<div class="fixed bottom-6 right-6 z-50">
    <button onclick="genererEmploiTemps()" 
            class="bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition-colors hover:scale-110 transform duration-200 flex items-center justify-center">
        <i data-lucide="play" class="w-6 h-6"></i>
    </button>
    <div class="absolute bottom-full right-0 mb-2 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 hover:opacity-100 transition-opacity whitespace-nowrap">
        Générer l'emploi du temps
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
        // Fonction pour afficher les onglets
        function afficherOnglet(onglet) {
            // Masquer tous les contenus
            document.querySelectorAll('.emploi-temps-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Désactiver tous les onglets
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                tab.classList.add('text-gray-600', 'hover:text-blue-600');
            });
            
            // Afficher le contenu sélectionné
            document.getElementById(`vue-${onglet}`).classList.remove('hidden');
            
            // Activer l'onglet sélectionné
            const tabActif = document.getElementById(`tab-${onglet}`);
            tabActif.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
            tabActif.classList.remove('text-gray-600', 'hover:text-blue-600');
            
            // Si c'est l'onglet professeurs, générer le contenu
            if (onglet === 'professeurs' && window.resultatsActuels) {
                genererEmploiParProf(window.resultatsActuels.emploi_par_prof);
            }
        }
        
        // Fonction pour générer l'affichage par professeur
        function genererEmploiParProf(emploiParProf) {
            const container = document.getElementById('liste-professeurs');
            container.innerHTML = '';
            
            Object.entries(emploiParProf).forEach(([nomProf, emploi]) => {
                const profDiv = document.createElement('div');
                profDiv.className = 'bg-gray-50 p-6 rounded-xl border border-gray-200';
                
                profDiv.innerHTML = `
                    <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i data-lucide="user" class="mr-2"></i>
                        ${nomProf}
                    </h4>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse text-sm">
                            <thead>
                                <tr class="border-b-2 border-gray-200 bg-white">
                                    <th class="text-left py-2 px-3 font-semibold text-gray-900 text-sm">Jour</th>
                                    <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">8h-9h</th>
                                    <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">9h-10h</th>
                                    <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">10h-11h</th>
                                    <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">11h-12h</th>
                                    <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">14h-15h</th>
                                    <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">15h-16h</th>
                                    <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">16h-17h</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(emploi).map(([jour, creneaux]) => `
                                    <tr class="border-b border-gray-100">
                                        <td class="py-3 px-4 font-medium text-gray-900">${jour}</td>
                                        ${Object.values(creneaux).map(creneau => `
                                            <td class="py-1 px-2">
                                                ${creneau.map(cours => `
                                                    <div class="text-xs bg-green-50 p-1 rounded mb-1 border-l-2 border-green-400 hover:bg-green-100 transition-colors">
                                                        <div class="font-medium text-green-900 truncate">${cours.classe}</div>
                                                        <div class="text-gray-700 truncate">${cours.matiere}</div>
                                                        <div class="text-gray-500 truncate text-xs">${cours.salle}</div>
                                                    </div>
                                                `).join('')}
                                            </td>
                                        `).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                container.appendChild(profDiv);
            });
            
            // Réinitialiser les icônes Lucide
            lucide.createIcons();
        }

        function genererEmploiTemps() {
    // Récupérer les données du formulaire
    const config = {
        nom_etablissement: document.getElementById('nom_etablissement').value,
        type_etablissement: document.getElementById('type_etablissement').value,
        nb_enseignants: parseInt(document.getElementById('nb_enseignants').value),
        nb_classes: parseInt(document.getElementById('nb_classes').value),
        nb_eleves: parseInt(document.getElementById('nb_eleves').value),
        nb_salles: parseInt(document.getElementById('nb_salles').value),
        salles_specialisees: {
            sport: document.getElementById('salle_sport').checked,
            info: document.getElementById('salle_info').checked,
            labo: document.getElementById('labo_sciences').checked,
            arts: document.getElementById('salle_arts').checked
        },
        contraintes: {
            temps_partiel: parseInt(document.getElementById('temps_partiel').value),
            transport_matin: document.getElementById('transport_matin').checked,
            transport_soir: document.getElementById('transport_soir').checked,
            pref_matin: document.getElementById('pref_matin').checked,
            pref_journee: document.getElementById('pref_journee').checked
        },
        matieres: {
            maths: parseInt(document.getElementById('maths').value),
            francais: parseInt(document.getElementById('francais').value),
            histoire: parseInt(document.getElementById('histoire').value),
            sciences: parseInt(document.getElementById('sciences').value),
            langues: parseInt(document.getElementById('langues').value),
            eps: parseInt(document.getElementById('eps').value)
        }
    };
    
    // Afficher le loading
    afficherLoading();
    
    // Simuler le traitement (dans une vraie app, ce serait un appel API)
    setTimeout(() => {
        const resultatsBruts = genererResultatsOptimises(config);
        
        // Adapter la structure des données pour l'affichage
        const resultats = {
            emploi_temps: resultatsBruts.emploi_temps,
            emploi_par_prof: resultatsBruts.emploi_par_prof,
            score_optimisation: resultatsBruts.metriques.optimisation / 100,
            score_satisfaction: resultatsBruts.metriques.satisfaction / 100,
            conflits_resolus: resultatsBruts.metriques.conflits_resolus,
            temps_calcul: resultatsBruts.metriques.temps_generation,
            recommandations: resultatsBruts.recommandations
        };
        
        // Stocker les résultats pour l'affichage par professeur
        window.resultatsActuels = resultats;
        
        afficherResultatsAvecAnimation(resultats);
    }, 2000);
}

function afficherLoading() {
    const container = document.getElementById('demo-results');
    container.innerHTML = `
        <div class="bg-white p-8 rounded-xl shadow-lg particles">
            <div class="text-center">
                <!-- Animation de loading principale -->
                <div class="relative w-24 h-24 mx-auto mb-8 animate-float">
                    <div class="absolute inset-0 border-4 border-blue-200 rounded-full animate-glow"></div>
                    <div class="absolute inset-0 border-4 border-transparent border-t-blue-600 rounded-full animate-spin"></div>
                    <div class="absolute inset-2 border-4 border-transparent border-r-green-600 rounded-full animate-spin" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
                    <div class="absolute inset-4 border-4 border-transparent border-b-purple-600 rounded-full animate-spin" style="animation-duration: 2s;"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="cpu" class="text-blue-600 w-8 h-8 animate-pulse"></i>
                    </div>
                </div>
                
                <h3 class="text-3xl font-bold text-gray-900 mb-4 animate-pulse">
                    <span class="inline-block animate-bounce">G</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.1s;">é</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.2s;">n</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.3s;">é</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.4s;">r</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.5s;">a</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.6s;">t</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.7s;">i</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.8s;">o</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 0.9s;">n</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 1.0s;">.</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 1.1s;">.</span>
                    <span class="inline-block animate-bounce" style="animation-delay: 1.2s;">.</span>
                </h3>
                
                <p class="text-gray-600 mb-8 text-lg">Notre IA analyse vos contraintes et optimise votre emploi du temps</p>
                
                <!-- Étapes de traitement avec animations -->
                <div class="space-y-6 max-w-md mx-auto">
                    <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="check" class="text-white w-4 h-4"></i>
                            </div>
                            <span class="text-gray-700 font-medium">Analyse des contraintes</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2 mr-2 progress-bar">
                                <div class="bg-blue-600 h-2 rounded-full animate-pulse" style="width: 100%"></div>
                            </div>
                            <span class="text-blue-600 font-bold">100%</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="users" class="text-white w-4 h-4"></i>
                            </div>
                            <span class="text-gray-700 font-medium">Optimisation des ressources</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2 mr-2 progress-bar">
                                <div class="bg-green-600 h-2 rounded-full animate-pulse" style="width: 75%"></div>
                            </div>
                            <span class="text-green-600 font-bold">75%</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-purple-50 rounded-lg border border-purple-200">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="calendar" class="text-white w-4 h-4"></i>
                            </div>
                            <span class="text-gray-700 font-medium">Génération de l'emploi du temps</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2 mr-2 progress-bar">
                                <div class="bg-purple-600 h-2 rounded-full animate-pulse" style="width: 50%"></div>
                            </div>
                            <span class="text-purple-600 font-bold">50%</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-orange-50 rounded-lg border border-orange-200">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-orange-600 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="zap" class="text-white w-4 h-4"></i>
                            </div>
                            <span class="text-gray-700 font-medium">Finalisation</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2 mr-2 progress-bar">
                                <div class="bg-orange-600 h-2 rounded-full animate-pulse" style="width: 25%"></div>
                            </div>
                            <span class="text-orange-600 font-bold">25%</span>
                        </div>
                    </div>
                </div>
                
                <!-- Message motivant -->
                <div class="mt-8 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200">
                    <p class="text-gray-700 font-medium">
                        <i data-lucide="lightbulb" class="inline-block mr-2 text-yellow-500"></i>
                        <span id="loading-message">Analyse des préférences des enseignants...</span>
                    </p>
                </div>
            </div>
        </div>
    `;
    
    // Réinitialiser les icônes
    lucide.createIcons();
    
    // Messages de loading dynamiques
    const messages = [
        "Analyse des préférences des enseignants...",
        "Calcul des contraintes horaires...",
        "Optimisation des salles de classe...",
        "Répartition équitable des matières...",
        "Vérification des conflits...",
        "Finalisation de l'emploi du temps...",
        "Génération des statistiques...",
        "Préparation de l'affichage..."
    ];
    
    let messageIndex = 0;
    const messageElement = document.getElementById('loading-message');
    
    const messageInterval = setInterval(() => {
        if (messageElement) {
            messageElement.textContent = messages[messageIndex];
            messageIndex = (messageIndex + 1) % messages.length;
        }
    }, 250);
    
    // Nettoyer l'intervalle après 2 secondes
    setTimeout(() => {
        clearInterval(messageInterval);
    }, 2000);
}

function genererResultatsOptimises(config) {
    // Calculer les métriques d'optimisation
    const totalMatiere = Object.values(config.matieres).reduce((a, b) => a + b, 0);
    const ratioEnseignantsClasses = config.nb_enseignants / config.nb_classes;
    const ratioSallesClasses = config.nb_salles / config.nb_classes;
    
    // Calculer les scores d'optimisation
    let scoreOptimisation = 85;
    let scoreSatisfaction = 80;
    let scoreUtilisation = 75;
    
    // Bonus selon les contraintes
    if (config.contraintes.temps_partiel > 0) {
        scoreOptimisation -= config.contraintes.temps_partiel * 2;
        scoreSatisfaction += config.contraintes.temps_partiel;
    }
    
    if (config.contraintes.transport_matin || config.contraintes.transport_soir) {
        scoreOptimisation -= 5;
        scoreSatisfaction -= 3;
    }
    
    if (config.contraintes.pref_matin && config.contraintes.pref_journee) {
        scoreSatisfaction += 8;
    }
    
    // Bonus pour les salles spécialisées
    const nbSallesSpecialisees = Object.values(config.salles_specialisees).filter(Boolean).length;
    scoreUtilisation += nbSallesSpecialisees * 3;
    
    // Limiter les scores
    scoreOptimisation = Math.min(98, Math.max(60, scoreOptimisation));
    scoreSatisfaction = Math.min(98, Math.max(65, scoreSatisfaction));
    scoreUtilisation = Math.min(95, Math.max(70, scoreUtilisation));
    
    // Générer l'emploi du temps
    const { emploiTemps, emploiParProf } = genererEmploiTempsStructure(config);
    
    return {
        config: config,
        metriques: {
            optimisation: scoreOptimisation,
            satisfaction: scoreSatisfaction,
            utilisation: scoreUtilisation,
            conflits_resolus: Math.max(95, 100 - (config.contraintes.temps_partiel * 2)),
            temps_generation: Math.max(0.5, 3 - (config.nb_enseignants / 20))
        },
        emploi_temps: emploiTemps,
        emploi_par_prof: emploiParProf,
        recommandations: genererRecommandations(config, scoreOptimisation, scoreSatisfaction)
    };
}

function genererEmploiTempsStructure(config) {
    const jours = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi'];
    const creneaux = ['8h-9h', '9h-10h', '10h-11h', '11h-12h', '14h-15h', '15h-16h', '16h-17h'];
    const matieresDisponibles = ['Maths', 'Français', 'Histoire', 'Sciences', 'Langues', 'EPS'];
    
    // Professeurs avec noms réalistes
    const professeurs = [
        { nom: 'Mme Dubois', prenom: 'Sophie', matieres: ['Maths', 'Sciences'], specialite: 'Mathématiques' },
        { nom: 'M. Martin', prenom: 'Pierre', matieres: ['Français', 'Histoire'], specialite: 'Lettres' },
        { nom: 'Mme Leroy', prenom: 'Marie', matieres: ['Langues'], specialite: 'Anglais' },
        { nom: 'M. Bernard', prenom: 'Jean', matieres: ['Sciences'], specialite: 'Physique-Chimie' },
        { nom: 'Mme Petit', prenom: 'Claire', matieres: ['Histoire'], specialite: 'Histoire-Géographie' },
        { nom: 'M. Rousseau', prenom: 'Antoine', matieres: ['EPS'], specialite: 'Éducation Physique' },
        { nom: 'Mme Moreau', prenom: 'Isabelle', matieres: ['Français'], specialite: 'Français' },
        { nom: 'M. Durand', prenom: 'François', matieres: ['Sciences'], specialite: 'SVT' },
        { nom: 'Mme Blanc', prenom: 'Nathalie', matieres: ['Maths'], specialite: 'Mathématiques' },
        { nom: 'M. Garcia', prenom: 'Carlos', matieres: ['Langues'], specialite: 'Espagnol' }
    ];
    
    // Salles de classe prédéfinies
    const salles = [
        { nom: 'A101', type: 'Salle générale', capacite: 30 },
        { nom: 'A102', type: 'Salle générale', capacite: 28 },
        { nom: 'A103', type: 'Salle générale', capacite: 32 },
        { nom: 'A104', type: 'Salle générale', capacite: 25 },
        { nom: 'B201', type: 'Laboratoire Sciences', capacite: 24 },
        { nom: 'B202', type: 'Laboratoire Sciences', capacite: 20 },
        { nom: 'C301', type: 'Salle Informatique', capacite: 30 },
        { nom: 'C302', type: 'Salle Informatique', capacite: 28 },
        { nom: 'D401', type: 'Salle de Langues', capacite: 25 },
        { nom: 'D402', type: 'Salle de Langues', capacite: 22 },
        { nom: 'E501', type: 'Salle d\'Arts', capacite: 20 },
        { nom: 'F601', type: 'CDI', capacite: 50 },
        { nom: 'G701', type: 'Salle de Musique', capacite: 25 },
        { nom: 'H801', type: 'Gymnase', capacite: 40 },
        { nom: 'H802', type: 'Salle EPS', capacite: 30 }
    ];
    
    // Matières enseignées
    const matieres = [
        'Mathématiques', 'Français', 'Anglais', 'Espagnol', 'Histoire-Géographie',
        'Sciences Physiques', 'SVT', 'Éducation Physique', 'Arts Plastiques',
        'Musique', 'Technologie', 'Informatique', 'Philosophie', 'Économie'
    ];
    
    // Classes de l'établissement
    const classes = [
        { nom: '6ème A', niveau: '6ème', eleves: 28 },
        { nom: '6ème B', niveau: '6ème', eleves: 26 },
        { nom: '6ème C', niveau: '6ème', eleves: 30 },
        { nom: '5ème A', niveau: '5ème', eleves: 27 },
        { nom: '5ème B', niveau: '5ème', eleves: 29 },
        { nom: '5ème C', niveau: '5ème', eleves: 25 },
        { nom: '4ème A', niveau: '4ème', eleves: 28 },
        { nom: '4ème B', niveau: '4ème', eleves: 26 },
        { nom: '4ème C', niveau: '4ème', eleves: 30 },
        { nom: '3ème A', niveau: '3ème', eleves: 27 },
        { nom: '3ème B', niveau: '3ème', eleves: 29 },
        { nom: '3ème C', niveau: '3ème', eleves: 25 }
    ];
    
    const emploiTemps = {};
    const emploiParProf = {};
    
    // Initialiser les emplois du temps
    jours.forEach(jour => {
        emploiTemps[jour] = {};
        creneaux.forEach(creneau => {
            emploiTemps[jour][creneau] = [];
        });
    });
    
    // Initialiser l'emploi par professeur
    professeurs.forEach(prof => {
        emploiParProf[prof.nom] = {};
        jours.forEach(jour => {
            emploiParProf[prof.nom][jour] = {};
            creneaux.forEach(creneau => {
                emploiParProf[prof.nom][jour][creneau] = [];
            });
        });
    });
    
    // Générer les cours
    jours.forEach(jour => {
        creneaux.forEach(creneau => {
            // Générer des cours pour chaque classe
            for (let classe = 1; classe <= Math.min(config.nb_classes, 6); classe++) {
                const matiere = matieresDisponibles[Math.floor(Math.random() * matieresDisponibles.length)];
                const salle = Math.floor(Math.random() * config.nb_salles) + 1;
                
                // Trouver un professeur pour cette matière
                const profsDisponibles = professeurs.filter(p => p.matieres.includes(matiere));
                const prof = profsDisponibles[Math.floor(Math.random() * profsDisponibles.length)];
                
                const cours = {
                    classe: `${config.type_etablissement === 'college' ? '6ème' : '1ère'}${classe}`,
                    matiere: matiere,
                    salle: `Salle ${salle}`,
                    professeur: prof.nom,
                    specialite: prof.specialite,
                    eleves: Math.floor(config.nb_eleves / config.nb_classes)
                };
                
                emploiTemps[jour][creneau].push(cours);
                emploiParProf[prof.nom][jour][creneau].push({
                    classe: cours.classe,
                    matiere: cours.matiere,
                    salle: cours.salle,
                    eleves: cours.eleves
                });
            }
        });
    });
    
    return { emploiTemps, emploiParProf };
}

function genererRecommandations(config, scoreOptimisation, scoreSatisfaction) {
    const recommandations = [];
    
    if (config.contraintes.temps_partiel > 5) {
        recommandations.push({
            type: 'warning',
            titre: 'Temps partiel élevé',
            description: 'Considérez embaucher plus d\'enseignants à temps plein pour améliorer la flexibilité.'
        });
    }
    
    if (scoreSatisfaction < 85) {
        recommandations.push({
            type: 'info',
            titre: 'Satisfaction enseignants',
            description: 'Ajustez les préférences horaires pour améliorer la satisfaction des enseignants.'
        });
    }
    
    if (config.nb_salles < config.nb_classes * 1.5) {
        recommandations.push({
            type: 'warning',
            titre: 'Salles insuffisantes',
            description: 'Le nombre de salles pourrait limiter l\'optimisation. Considérez des salles partagées.'
        });
    }
    
    if (scoreOptimisation > 90) {
        recommandations.push({
            type: 'success',
            titre: 'Configuration optimale',
            description: 'Votre configuration permet une excellente optimisation. Félicitations !'
        });
    }
    
    return recommandations;
}

function afficherResultatsAvecAnimation(resultats) {
    const container = document.getElementById('demo-results');
    
    // Animation de transition avec effet de fondu
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
        afficherResultats(resultats);
        
        // Animation d'apparition
        container.style.transition = 'all 0.6s ease-out';
        container.style.opacity = '1';
        container.style.transform = 'translateY(0)';
        
        // Animation des éléments individuels
        setTimeout(() => {
            const elements = container.querySelectorAll('.bg-white');
            elements.forEach((element, index) => {
                element.style.opacity = '0';
                element.style.transform = 'translateY(30px)';
                element.style.transition = 'all 0.4s ease-out';
                
                setTimeout(() => {
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }, 200);
    }, 300);
}

function afficherResultats(resultats) {
    const container = document.getElementById('demo-results');
    
    container.innerHTML = `
        <div class="space-y-8">
            <!-- Métriques d'optimisation -->
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Résultats d'optimisation</h3>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-blue-600 mb-2">${resultats.metriques.optimisation}%</div>
                        <div class="text-gray-600">Optimisation</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600 mb-2">${resultats.metriques.satisfaction}%</div>
                        <div class="text-gray-600">Satisfaction</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-purple-600 mb-2">${resultats.metriques.utilisation}%</div>
                        <div class="text-gray-600">Utilisation salles</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-orange-600 mb-2">${resultats.metriques.conflits_resolus}%</div>
                        <div class="text-gray-600">Conflits résolus</div>
                    </div>
                </div>
                
                <div class="bg-green-50 p-4 rounded-lg">
                    <p class="text-green-800">
                        <i data-lucide="check-circle" class="inline-block mr-2"></i>
                        Emploi du temps généré en ${resultats.metriques.temps_generation.toFixed(1)} secondes
                    </p>
                </div>
            </div>
            
            <!-- Emploi du temps -->
            <div class="bg-white p-8 rounded-xl shadow-lg">
                    <!-- Onglets -->
                    <div class="mb-6">
                        <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg">
                            <button onclick="afficherOnglet('general')" id="tab-general" 
                                    class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors bg-white text-blue-600 shadow-sm">
                                <i data-lucide="calendar" class="inline-block mr-2"></i>
                                Vue générale
                            </button>
                            <button onclick="afficherOnglet('professeurs')" id="tab-professeurs" 
                                    class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors text-gray-600 hover:text-blue-600">
                                <i data-lucide="users" class="inline-block mr-2"></i>
                                Par professeur
                            </button>
                        </div>
                    </div>
                    
                    <!-- Vue générale -->
                    <div id="vue-generale" class="emploi-temps-content">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">
                            <i data-lucide="calendar" class="inline-block mr-2"></i>
                            Emploi du temps général
                        </h3>
                
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse text-sm">
                        <thead>
                            <tr class="border-b-2 border-gray-200 bg-gray-50">
                                <th class="text-left py-2 px-3 font-semibold text-gray-900 text-sm">Jour</th>
                                <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">8h-9h</th>
                                <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">9h-10h</th>
                                <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">10h-11h</th>
                                <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">11h-12h</th>
                                <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">14h-15h</th>
                                <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">15h-16h</th>
                                <th class="text-left py-2 px-2 font-semibold text-gray-900 text-sm">16h-17h</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(resultats.emploi_temps).map(([jour, creneaux]) => `
                                <tr class="border-b border-gray-100">
                                    <td class="py-3 px-4 font-medium text-gray-900">${jour}</td>
                                    ${Object.values(creneaux).map(creneau => `
                                        <td class="py-1 px-2">
                                            ${creneau.slice(0, 4).map(cours => `
                                <div class="text-xs bg-blue-50 p-1 rounded mb-1 border-l-2 border-blue-400 hover:bg-blue-100 transition-colors">
                                    <div class="font-medium text-blue-900 truncate">${cours.classe}</div>
                                    <div class="text-gray-700 truncate">${cours.matiere}</div>
                                    <div class="text-gray-500 truncate text-xs">${cours.professeur}</div>
                                    <div class="text-gray-400 truncate text-xs">${cours.salle}</div>
                                </div>
                                            `).join('')}
                                        </td>
                                    `).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                    </div>
                    
                    <!-- Vue par professeur -->
                    <div id="vue-professeurs" class="emploi-temps-content hidden">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">
                            <i data-lucide="users" class="inline-block mr-2"></i>
                            Emploi du temps par professeur
                        </h3>
                        
                        <div id="liste-professeurs" class="space-y-6">
                            <!-- Les emplois du temps par professeur seront générés ici -->
                        </div>
                    </div>
            </div>
            
            <!-- Recommandations -->
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Recommandations</h3>
                
                <div class="space-y-4">
                    ${resultats.recommandations.map(rec => `
                        <div class="flex items-start p-4 rounded-lg ${
                            rec.type === 'success' ? 'bg-green-50 border border-green-200' :
                            rec.type === 'warning' ? 'bg-yellow-50 border border-yellow-200' :
                            'bg-blue-50 border border-blue-200'
                        }">
                            <i data-lucide="${
                                rec.type === 'success' ? 'check-circle' :
                                rec.type === 'warning' ? 'alert-triangle' :
                                'info'
                            }" class="text-${
                                rec.type === 'success' ? 'green' :
                                rec.type === 'warning' ? 'yellow' :
                                'blue'
                            }-600 mr-3 mt-1"></i>
                            <div>
                                <h4 class="font-semibold text-gray-900">${rec.titre}</h4>
                                <p class="text-gray-600">${rec.description}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Actions -->
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Actions</h3>
                
                <div class="flex flex-wrap gap-4">
                    <button onclick="exporterPDF()" class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                        <i data-lucide="download" class="inline-block mr-2"></i>
                        Exporter en PDF
                    </button>
                    <button onclick="exporterExcel()" class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                        <i data-lucide="file-spreadsheet" class="inline-block mr-2"></i>
                        Exporter en Excel
                    </button>
                    <button onclick="partagerEmploiTemps()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                        <i data-lucide="share" class="inline-block mr-2"></i>
                        Partager
                    </button>
                    <button onclick="genererEmploiTemps()" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors">
                        <i data-lucide="refresh-cw" class="inline-block mr-2"></i>
                        Régénérer
                    </button>
                </div>
            </div>
            
            <!-- Statistiques détaillées -->
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">
                    <i data-lucide="bar-chart-3" class="inline-block mr-2"></i>
                    Statistiques détaillées
                </h3>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Heures par enseignant -->
                    <div>
                        <h4 class="text-xl font-semibold text-gray-800 mb-4">
                            <i data-lucide="clock" class="inline-block mr-2"></i>
                            Heures par enseignant
                        </h4>
                        <div class="space-y-3 max-h-80 overflow-y-auto">
                            ${genererStatistiquesEnseignants(resultats.emploi_par_prof)}
                        </div>
                    </div>
                    
                    <!-- Taux d'occupation des salles -->
                    <div>
                        <h4 class="text-xl font-semibold text-gray-800 mb-4">
                            <i data-lucide="building" class="inline-block mr-2"></i>
                            Occupation des salles
                        </h4>
                        <div class="space-y-3 max-h-80 overflow-y-auto">
                            ${genererStatistiquesSalles(resultats.emploi_temps)}
                        </div>
                    </div>
                </div>
                
                <!-- Répartition des matières -->
                <div class="mt-8">
                    <h4 class="text-xl font-semibold text-gray-800 mb-4">
                        <i data-lucide="pie-chart" class="inline-block mr-2"></i>
                        Répartition des matières
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        ${genererStatistiquesMatieres(resultats.emploi_temps)}
                    </div>
                </div>
                
                <!-- Indicateurs de performance -->
                <div class="mt-8">
                    <h4 class="text-xl font-semibold text-gray-800 mb-4">
                        <i data-lucide="trending-up" class="inline-block mr-2"></i>
                        Indicateurs de performance
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 text-center">
                            <div class="text-2xl font-bold text-blue-600">${resultats.score_optimisation * 100}%</div>
                            <div class="text-sm text-blue-800">Score d'optimisation</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
                            <div class="text-2xl font-bold text-green-600">${resultats.score_satisfaction * 100}%</div>
                            <div class="text-sm text-green-800">Satisfaction enseignants</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 text-center">
                            <div class="text-2xl font-bold text-purple-600">${resultats.conflits_resolus}</div>
                            <div class="text-sm text-purple-800">Conflits résolus</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200 text-center">
                            <div class="text-2xl font-bold text-orange-600">${resultats.temps_calcul}s</div>
                            <div class="text-sm text-orange-800">Temps de calcul</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Réinitialiser les icônes
    lucide.createIcons();
}

function exporterPDF() {
    alert('Fonctionnalité d\'export PDF en cours de développement');
}

function exporterExcel() {
    alert('Fonctionnalité d\'export Excel en cours de développement');
}

function partagerEmploiTemps() {
    alert('Fonctionnalité de partage en cours de développement');
}

// Fonctions pour générer les statistiques détaillées
function genererStatistiquesEnseignants(emploiParProf) {
    const stats = [];
    
    Object.keys(emploiParProf).forEach(nomProf => {
        const cours = emploiParProf[nomProf];
        const totalHeures = cours.length;
        const heuresParJour = {};
        
        // Compter les heures par jour
        cours.forEach(cours => {
            const jour = cours.jour;
            heuresParJour[jour] = (heuresParJour[jour] || 0) + 1;
        });
        
        // Calculer la charge de travail
        const chargeMax = 35; // Heures max par semaine
        const pourcentageCharge = Math.min((totalHeures / chargeMax) * 100, 100);
        
        stats.push(`
            <div class="p-4 bg-gray-50 rounded-lg border">
                <div class="flex justify-between items-start mb-2">
                    <div class="font-semibold text-gray-900">${nomProf}</div>
                    <div class="text-sm font-bold text-blue-600">${totalHeures}h</div>
                </div>
                <div class="mb-2">
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                        <span>Charge de travail</span>
                        <span>${pourcentageCharge.toFixed(1)}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${pourcentageCharge}%"></div>
                    </div>
                </div>
                <div class="text-xs text-gray-500">
                    ${Object.entries(heuresParJour).map(([jour, heures]) => `${jour}: ${heures}h`).join(' • ')}
                </div>
            </div>
        `);
    });
    
    return stats.join('');
}

function genererStatistiquesSalles(emploiTemps) {
    const occupationSalles = {};
    const totalCreneaux = 35; // 5 jours × 7 créneaux
    
    // Compter l'occupation de chaque salle
    Object.values(emploiTemps).forEach(cours => {
        cours.forEach(c => {
            const salle = c.salle;
            occupationSalles[salle] = (occupationSalles[salle] || 0) + 1;
        });
    });
    
    const stats = [];
    Object.entries(occupationSalles).forEach(([salle, occupation]) => {
        const tauxOccupation = (occupation / totalCreneaux) * 100;
        const couleur = tauxOccupation > 80 ? 'red' : tauxOccupation > 60 ? 'yellow' : 'green';
        
        stats.push(`
            <div class="p-4 bg-gray-50 rounded-lg border">
                <div class="flex justify-between items-start mb-2">
                    <div class="font-semibold text-gray-900">Salle ${salle}</div>
                    <div class="text-sm font-bold text-${couleur}-600">${tauxOccupation.toFixed(1)}%</div>
                </div>
                <div class="mb-2">
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                        <span>Occupation</span>
                        <span>${occupation}/${totalCreneaux} créneaux</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-${couleur}-600 h-2 rounded-full" style="width: ${tauxOccupation}%"></div>
                    </div>
                </div>
                <div class="text-xs text-gray-500">
                    ${tauxOccupation > 80 ? 'Très occupée' : tauxOccupation > 60 ? 'Bien occupée' : 'Sous-utilisée'}
                </div>
            </div>
        `);
    });
    
    return stats.join('');
}

function genererStatistiquesMatieres(emploiTemps) {
    const matieresCount = {};
    
    // Compter les cours par matière
    Object.values(emploiTemps).forEach(cours => {
        cours.forEach(c => {
            const matiere = c.matiere;
            matieresCount[matiere] = (matieresCount[matiere] || 0) + 1;
        });
    });
    
    const totalCours = Object.values(matieresCount).reduce((sum, count) => sum + count, 0);
    const couleurs = ['blue', 'green', 'purple', 'orange', 'red', 'indigo'];
    let couleurIndex = 0;
    
    return Object.entries(matieresCount).map(([matiere, count]) => {
        const pourcentage = ((count / totalCours) * 100).toFixed(1);
        const couleur = couleurs[couleurIndex % couleurs.length];
        couleurIndex++;
        
        return `
            <div class="bg-${couleur}-50 p-4 rounded-lg border border-${couleur}-200 text-center">
                <div class="text-2xl font-bold text-${couleur}-600">${count}</div>
                <div class="text-sm text-${couleur}-800 font-medium">${matiere}</div>
                <div class="text-xs text-${couleur}-600">${pourcentage}%</div>
            </div>
        `;
    }).join('');
}

// Afficher les listes prédéfinies
function afficherListesPredefinies() {
    const container = document.getElementById('listes-predefinies');
    if (!container) return;
    
    container.innerHTML = `
        <div class="bg-white p-8 rounded-xl shadow-lg">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">
                <i data-lucide="list" class="inline-block mr-2"></i>
                Données prédéfinies de l'établissement
            </h3>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Liste des enseignants -->
                <div>
                    <h4 class="text-xl font-semibold text-gray-800 mb-4">
                        <i data-lucide="users" class="inline-block mr-2"></i>
                        Enseignants (${professeurs.length})
                    </h4>
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        ${professeurs.map(prof => `
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border">
                                <div>
                                    <div class="font-semibold text-gray-900">${prof.nom} ${prof.prenom}</div>
                                    <div class="text-sm text-gray-600">${prof.specialite}</div>
                                </div>
                                <div class="text-xs text-gray-500">
                                    ${prof.matieres.join(', ')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Liste des salles -->
                <div>
                    <h4 class="text-xl font-semibold text-gray-800 mb-4">
                        <i data-lucide="building" class="inline-block mr-2"></i>
                        Salles de classe (${salles.length})
                    </h4>
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        ${salles.map(salle => `
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border">
                                <div>
                                    <div class="font-semibold text-gray-900">${salle.nom}</div>
                                    <div class="text-sm text-gray-600">${salle.type}</div>
                                </div>
                                <div class="text-xs text-gray-500">
                                    ${salle.capacite} places
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
            
            <!-- Liste des matières -->
            <div class="mt-8">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">
                    <i data-lucide="book-open" class="inline-block mr-2"></i>
                    Matières enseignées (${matieres.length})
                </h4>
                <div class="flex flex-wrap gap-2">
                    ${matieres.map(matiere => `
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                            ${matiere}
                        </span>
                    `).join('')}
                </div>
            </div>
            
            <!-- Liste des classes -->
            <div class="mt-8">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">
                    <i data-lucide="graduation-cap" class="inline-block mr-2"></i>
                    Classes de l'établissement (${classes.length})
                </h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    ${classes.map(classe => `
                        <div class="p-3 bg-green-50 rounded-lg border text-center">
                            <div class="font-semibold text-gray-900">${classe.nom}</div>
                            <div class="text-sm text-gray-600">${classe.niveau}</div>
                            <div class="text-xs text-gray-500">${classe.eleves} élèves</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
    `;
    
    // Réinitialiser les icônes
    lucide.createIcons();
}

// Appeler la fonction au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    afficherListesPredefinies();
});
</script>
{% endblock %}
